<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Insurance Premium Calculator</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #EFF6FF 0%, #E0E7FF 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 40px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header-icon {
            width: 64px;
            height: 64px;
            background: #E0E7FF;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 16px;
        }
        
        h1 {
            color: #1F2937;
            font-size: 2.5rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #6B7280;
            font-size: 1rem;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #4F46E5;
            font-size: 1.1rem;
        }
        
        .inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }
        
        input, select {
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #4F46E5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .radio-group {
            display: flex;
            gap: 24px;
            margin-top: 8px;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: normal;
        }
        
        .radio-label input {
            margin-right: 8px;
            width: auto;
        }
        
        .results {
            background: linear-gradient(135deg, #4F46E5 0%, #6366F1 100%);
            border-radius: 16px;
            padding: 40px;
            color: white;
            margin-bottom: 24px;
            text-align: center;
        }
        
        .results-header {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        .premium-amount {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .premium-period {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 24px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            padding-top: 24px;
            border-top: 1px solid rgba(255,255,255,0.3);
        }
        
        .result-item {
            text-align: center;
        }
        
        .result-label {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-bottom: 4px;
        }
        
        .result-value {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .risk-analysis {
            background: #DBEAFE;
            border: 2px solid #93C5FD;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .risk-analysis h3 {
            color: #1E40AF;
            margin-bottom: 12px;
            font-size: 1.125rem;
        }
        
        .risk-analysis p {
            color: #1E3A8A;
            line-height: 1.6;
            margin-bottom: 12px;
        }
        
        .risk-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .risk-stat {
            background: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }
        
        .risk-stat-label {
            font-size: 0.75rem;
            color: #6B7280;
            margin-bottom: 4px;
        }
        
        .risk-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1E40AF;
        }
        
        .disclaimer {
            background: #FEF3C7;
            border: 2px solid #FCD34D;
            border-radius: 12px;
            padding: 20px;
            color: #92400E;
            font-size: 0.875rem;
            line-height: 1.6;
        }
        
        .disclaimer strong {
            color: #78350F;
        }
        
        #output {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-icon">‚ù§Ô∏è</div>
            <h1>Life Insurance Premium Calculator</h1>
            <p class="subtitle">Based on 2025 actuarial mortality tables</p>
        </div>
        
        <div id="loading" class="loading">
            Loading actuarial data...
        </div>
        
        <div id="calculator" style="display: none;">
            <div class="inputs-grid">
                <div class="input-group">
                    <label for="age">üë§ Age</label>
                    <input type="number" id="age" min="18" max="80" value="35">
                </div>
                
                <div class="input-group">
                    <label for="gender">Gender</label>
                    <select id="gender">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="coverage">üíµ Coverage Amount</label>
                    <select id="coverage">
                        <option value="100000">$100,000</option>
                        <option value="250000">$250,000</option>
                        <option value="500000" selected>$500,000</option>
                        <option value="750000">$750,000</option>
                        <option value="1000000">$1,000,000</option>
                        <option value="1500000">$1,500,000</option>
                        <option value="2000000">$2,000,000</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="term">üìÖ Term Length (Years)</label>
                    <select id="term">
                        <option value="10">10 Years</option>
                        <option value="15">15 Years</option>
                        <option value="20" selected>20 Years</option>
                        <option value="25">25 Years</option>
                        <option value="30">30 Years</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="health">üè• Health Rating</label>
                    <select id="health">
                        <option value="preferred-plus">Preferred Plus (Excellent)</option>
                        <option value="preferred" selected>Preferred (Good)</option>
                        <option value="standard">Standard (Average)</option>
                        <option value="substandard">Substandard (Below Average)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>üö¨ Tobacco Use</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="smoker" value="no" checked>
                            Non-Smoker
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="smoker" value="yes">
                            Smoker
                        </label>
                    </div>
                </div>
            </div>
            
            <div id="results"></div>
        </div>
    </div>
    
    <div id="output"></div>
    
    <script type="py" src="https://pyscript.net/releases/2024.1.1/core.js" config='{"packages": ["pandas"]}'>
import pandas as pd
from pyscript import document, window
from js import console, fetch
import json

# Global variables to store data
death_prob_data = {'male': None, 'female': None}

async def load_csv_data():
    """Load the CSV files"""
    try:
        # Load female data
        female_response = await fetch('./DeathProbsE_F_Alt2_TR2025.csv')
        female_text = await female_response.text()
        
        # Load male data
        male_response = await fetch('./DeathProbsE_M_Alt2_TR2025.csv')
        male_text = await male_response.text()
        
        # Parse CSVs (skip first row which is description)
        from io import StringIO
        
        female_lines = female_text.split('\n')[1:]
        female_csv = '\n'.join(female_lines)
        female_df = pd.read_csv(StringIO(female_csv))
        
        male_lines = male_text.split('\n')[1:]
        male_csv = '\n'.join(male_lines)
        male_df = pd.read_csv(StringIO(male_csv))
        
        # Get 2025 data
        female_2025 = female_df[female_df['Year'] == 2025].iloc[0]
        male_2025 = male_df[male_df['Year'] == 2025].iloc[0]
        
        death_prob_data['female'] = female_2025
        death_prob_data['male'] = male_2025
        
        # Hide loading, show calculator
        document.getElementById('loading').style.display = 'none'
        document.getElementById('calculator').style.display = 'block'
        
        # Initial calculation
        calculate_premium()
        
    except Exception as e:
        console.log(f"Error loading data: {e}")
        document.getElementById('loading').innerHTML = f'<p style="color: red;">Error loading data: {e}</p>'

def get_death_probability(age, gender):
    """Get death probability for specific age and gender"""
    if death_prob_data[gender] is None:
        return 0
    
    try:
        prob = death_prob_data[gender][str(age)]
        return prob if pd.notna(prob) else 0
    except:
        return 0

def calculate_premium(*args):
    """Calculate premium and display results"""
    # Get input values
    age = int(document.getElementById('age').value)
    gender = document.getElementById('gender').value
    coverage_amount = int(document.getElementById('coverage').value)
    term_length = int(document.getElementById('term').value)
    health_rating = document.getElementById('health').value
    smoker = document.querySelector('input[name="smoker"]:checked').value == 'yes'
    
    # Health rating factors
    health_factors = {
        'preferred-plus': 0.7,
        'preferred': 1.0,
        'standard': 1.4,
        'substandard': 2.0
    }
    
    # Calculate expected present value of claims
    expected_claims = 0
    survival_probability = 1
    discount_rate = 0.03
    cumulative_death_prob = 0
    
    for year in range(term_length):
        current_age = age + year
        death_prob = get_death_probability(current_age, gender)
        
        # Adjust for smoking
        if smoker:
            death_prob *= 2.5
        
        # Adjust for health rating
        death_prob *= health_factors[health_rating]
        
        # Probability of dying this year
        death_this_year = survival_probability * death_prob
        cumulative_death_prob += death_this_year
        
        # Present value of claim
        discount_factor = (1 + discount_rate) ** (-(year + 0.5))
        expected_claims += death_this_year * coverage_amount * discount_factor
        
        # Update survival probability
        survival_probability *= (1 - death_prob)
    
    # Add profit margin and expenses
    profit_margin = 1.25
    expense_loading = 100
    
    # Calculate present value of annuity
    monthly_discount_rate = (1 + discount_rate) ** (1/12) - 1
    num_payments = term_length * 12
    annuity_pv = (1 - (1 + monthly_discount_rate) ** (-num_payments)) / monthly_discount_rate
    
    # Monthly premium
    monthly_premium = max((expected_claims * profit_margin) / annuity_pv + expense_loading, 10)
    
    annual_premium = monthly_premium * 12
    total_cost = annual_premium * term_length
    cumulative_risk = cumulative_death_prob * 100
    
    # Display results
    results_html = f"""
    <div class="results">
        <div class="results-header">Estimated Monthly Premium</div>
        <div class="premium-amount">${monthly_premium:.2f}</div>
        <div class="premium-period">per month</div>
        <div class="results-grid">
            <div class="result-item">
                <div class="result-label">Annual Premium</div>
                <div class="result-value">${annual_premium:.2f}</div>
            </div>
            <div class="result-item">
                <div class="result-label">Total Cost ({term_length} years)</div>
                <div class="result-value">${total_cost:,.0f}</div>
            </div>
        </div>
    </div>
    
    <div class="risk-analysis">
        <h3>üìä Mortality Risk Analysis</h3>
        <p>Based on actuarial tables, the cumulative probability of death over the {term_length}-year term 
        is <strong>{cumulative_risk:.3f}%</strong> for a {age}-year-old {gender} with your health profile.</p>
        <p style="font-size: 0.875rem;">This means approximately <strong>{round(cumulative_risk * 10)} out of 1,000</strong> people with your 
        profile would be expected to pass away during the policy term.</p>
        <div class="risk-stats">
            <div class="risk-stat">
                <div class="risk-stat-label">Cumulative Risk</div>
                <div class="risk-stat-value">{cumulative_risk:.3f}%</div>
            </div>
            <div class="risk-stat">
                <div class="risk-stat-label">Per 1,000 People</div>
                <div class="risk-stat-value">{round(cumulative_risk * 10)}</div>
            </div>
        </div>
    </div>
    
    <div class="disclaimer">
        <strong>Note:</strong> This calculator uses actual 2025 Social Security Administration mortality 
        tables to provide actuarially-based estimates. However, this is still an estimate only. 
        Actual premiums may vary based on additional factors including specific health conditions, 
        family history, occupation, hobbies, and the insurance company's underwriting guidelines. 
        Contact a licensed insurance agent for an accurate quote.
    </div>
    """
    
    document.getElementById('results').innerHTML = results_html

# Add event listeners to all inputs
def setup_listeners():
    document.getElementById('age').addEventListener('input', calculate_premium)
    document.getElementById('gender').addEventListener('change', calculate_premium)
    document.getElementById('coverage').addEventListener('change', calculate_premium)
    document.getElementById('term').addEventListener('change', calculate_premium)
    document.getElementById('health').addEventListener('change', calculate_premium)
    
    for radio in document.querySelectorAll('input[name="smoker"]'):
        radio.addEventListener('change', calculate_premium)

# Initialize
await load_csv_data()
setup_listeners()
    </script>
</body>
</html>